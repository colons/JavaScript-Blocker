/***************************************
 * @file js/beautify.min.js
 * @author Sandro Padin (s@ndropad.in)
 * @package JS Beautify Safari Extension (https://github.com/spadin/js-beautify-safari-extension)
 * @version 1.3
 ***************************************/
function js_beautify(P,p){function C(a){for(a=typeof a==="undefined"?false:a;e.length&&(e[e.length-1]===" "||e[e.length-1]===x||a&&(e[e.length-1]==="\n"||e[e.length-1]==="\r"));)e.pop()}function h(a){c.eat_next_space=false;if(!(s&&D(c.mode))){a=typeof a==="undefined"?true:a;c.if_line=false;C();if(e.length){if(e[e.length-1]!=="\n"||!a){v=true;e.push("\n")}for(a=0;a<c.indentation_level;a+=1)e.push(x);if(c.var_line&&c.var_line_reindented)Q===" "?e.push("    "):e.push(x)}}}function l(){if(c.eat_next_space)c.eat_next_space=
false;else{var a=" ";if(e.length)a=e[e.length-1];a!==" "&&a!=="\n"&&a!==x&&e.push(" ")}}function m(){v=false;c.eat_next_space=false;e.push(k)}function K(){e.length&&e[e.length-1]===x&&e.pop()}function w(a){c&&E.push(c);c={previous_mode:c?c.mode:"BLOCK",mode:a,var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,if_line:false,in_case:false,eat_next_space:false,indentation_baseline:-1,indentation_level:c?c.indentation_level+(c.var_line&&c.var_line_reindented?1:0):T}}
function D(a){return a==="[EXPRESSION]"||a==="[INDENTED-EXPRESSION]"}function F(a){return a==="[EXPRESSION]"||a==="[INDENTED-EXPRESSION]"||a==="(EXPRESSION)"}function G(){H=c.mode==="DO_BLOCK";if(E.length>0)c=E.pop()}function o(a,i){for(var j=0;j<i.length;j+=1)if(i[j]===a)return true;return false}function U(){for(var a=0,i=0,j=e.length-1;j>=0;j--)switch(e[j]){case ":":a===0&&i++;break;case "?":if(a===0)if(i===0)return true;else i--;break;case "{":if(a===0)return false;a--;break;case "(":case "[":a--;
break;case ")":case "]":case "}":a++}}function L(){t=0;if(b>=q)return["","TK_EOF"];B=false;var a=f.charAt(b);b+=1;if(s&&D(c.mode)){for(var i=0;o(a,M);){if(a==="\n"){C();e.push("\n");v=true;i=0}else if(a==="\t")i+=4;else if(a!=="\r")i+=1;if(b>=q)return["","TK_EOF"];a=f.charAt(b);b+=1}if(c.indentation_baseline===-1)c.indentation_baseline=i;if(v){var j;for(j=0;j<c.indentation_level+1;j+=1)e.push(x);if(c.indentation_baseline!==-1)for(j=0;j<i-c.indentation_baseline;j++)e.push(" ")}}else{for(;o(a,M);){if(a===
"\n")t+=R?t<=R?1:0:1;if(b>=q)return["","TK_EOF"];a=f.charAt(b);b+=1}if(N)if(t>1)for(j=0;j<t;j+=1){h(j===0);v=true}B=t>0}if(o(a,I)){if(b<q)for(;o(f.charAt(b),I);){a+=f.charAt(b);b+=1;if(b===q)break}if(b!==q&&a.match(/^[0-9]+[Ee]$/)&&(f.charAt(b)==="-"||f.charAt(b)==="+")){i=f.charAt(b);b+=1;j=L(b);a+=i+j[0];return[a,"TK_WORD"]}if(a==="in")return[a,"TK_OPERATOR"];if(B&&d!=="TK_OPERATOR"&&!c.if_line&&(N||g!=="var"))h();return[a,"TK_WORD"]}if(a==="("||a==="[")return[a,"TK_START_EXPR"];if(a===")"||a===
"]")return[a,"TK_END_EXPR"];if(a==="{")return[a,"TK_START_BLOCK"];if(a==="}")return[a,"TK_END_BLOCK"];if(a===";")return[a,"TK_SEMICOLON"];if(a==="/"){i="";j=true;if(f.charAt(b)==="*"){b+=1;if(b<q)for(;!(f.charAt(b)==="*"&&f.charAt(b+1)&&f.charAt(b+1)==="/")&&b<q;){a=f.charAt(b);i+=a;if(a==="\r"||a==="\n")j=false;b+=1;if(b>=q)break}b+=2;return j?["/*"+i+"*/","TK_INLINE_COMMENT"]:["/*"+i+"*/","TK_BLOCK_COMMENT"]}if(f.charAt(b)==="/"){for(i=a;f.charAt(b)!=="\r"&&f.charAt(b)!=="\n";){i+=f.charAt(b);b+=
1;if(b>=q)break}b+=1;B&&h();return[i,"TK_COMMENT"]}}if(a==="'"||a==='"'||a==="/"&&(d==="TK_WORD"&&o(g,["return","do"])||d==="TK_COMMENT"||d==="TK_START_EXPR"||d==="TK_START_BLOCK"||d==="TK_END_BLOCK"||d==="TK_OPERATOR"||d==="TK_EQUALS"||d==="TK_EOF"||d==="TK_SEMICOLON")){i=a;j=false;var u=a;if(b<q)if(i==="/")for(a=false;j||a||f.charAt(b)!==i;){u+=f.charAt(b);if(j)j=false;else{j=f.charAt(b)==="\\";if(f.charAt(b)==="[")a=true;else if(f.charAt(b)==="]")a=false}b+=1;if(b>=q)return[u,"TK_STRING"]}else for(;j||
f.charAt(b)!==i;){u+=f.charAt(b);j=j?false:f.charAt(b)==="\\";b+=1;if(b>=q)return[u,"TK_STRING"]}b+=1;u+=i;if(i==="/")for(;b<q&&o(f.charAt(b),I);){u+=f.charAt(b);b+=1}return[u,"TK_STRING"]}if(a==="#"){if(e.length===0&&f.charAt(b)==="!"){for(u=a;b<q&&a!="\n";){a=f.charAt(b);u+=a;b+=1}e.push(u.replace(/^\s\s*|\s\s*$/,"")+"\n");h();return L()}i="#";if(b<q&&o(f.charAt(b),S)){do{a=f.charAt(b);i+=a;b+=1}while(b<q&&a!=="#"&&a!=="=");if(a!=="#")if(f.charAt(b)==="["&&f.charAt(b+1)==="]"){i+="[]";b+=2}else if(f.charAt(b)===
"{"&&f.charAt(b+1)==="}"){i+="{}";b+=2}return[i,"TK_WORD"]}}if(a==="<"&&f.substring(b-1,b+3)==="<\!--"){b+=3;c.in_html_comment=true;return["<\!--","TK_COMMENT"]}if(a==="-"&&c.in_html_comment&&f.substring(b-1,b+2)==="--\>"){c.in_html_comment=false;b+=2;B&&h();return["--\>","TK_COMMENT"]}if(o(a,O)){for(;b<q&&o(a+f.charAt(b),O);){a+=f.charAt(b);b+=1;if(b>=q)break}return a==="="?[a,"TK_EQUALS"]:[a,"TK_OPERATOR"]}return[a,"TK_UNKNOWN"]}var f,e,k,d,g,r,y,c,E,x,M,I,O,b,z,S,n,A,H,B,v,t;p=p?p:{};var J=p.braces_on_own_line?
p.braces_on_own_line:false;y=p.indent_size?p.indent_size:4;var Q=p.indent_char?p.indent_char:" ",N=typeof p.preserve_newlines==="undefined"?true:p.preserve_newlines,R=typeof p.max_preserve_newlines==="undefined"?false:p.max_preserve_newlines,T=p.indent_level?p.indent_level:0,V=p.space_after_anon_function==="undefined"?false:p.space_after_anon_function,s=typeof p.keep_array_indentation==="undefined"?false:p.keep_array_indentation;v=false;var q=P.length;for(x="";y>0;){x+=Q;y-=1}f=P;y="";d="TK_START_EXPR";
r=g="";e=[];H=false;M="\n\r\t ".split("");I="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$$".split("");S="0123456789".split("");O="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::".split(" ");z="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");E=[];w("BLOCK");for(b=0;;){A=L(b);k=A[0];A=A[1];if(A==="TK_EOF")break;switch(A){case "TK_START_EXPR":if(k==="["){if(d==="TK_WORD"||g===
")"){o(g,z)&&l();w("(EXPRESSION)");m();break}if(c.mode==="[EXPRESSION]"||c.mode==="[INDENTED-EXPRESSION]")if(r==="]"&&g===","){if(c.mode==="[EXPRESSION]"){c.mode="[INDENTED-EXPRESSION]";s||(c.indentation_level+=1)}w("[EXPRESSION]");s||h()}else if(g==="["){if(c.mode==="[EXPRESSION]"){c.mode="[INDENTED-EXPRESSION]";s||(c.indentation_level+=1)}w("[EXPRESSION]");s||h()}else w("[EXPRESSION]");else w("[EXPRESSION]")}else w("(EXPRESSION)");if(g===";"||d==="TK_START_BLOCK")h();else if(!(d==="TK_END_EXPR"||
d==="TK_START_EXPR"||d==="TK_END_BLOCK"||g==="."))if(d!=="TK_WORD"&&d!=="TK_OPERATOR")l();else if(y==="function")V&&l();else if(o(g,z)||g==="catch")l();m();break;case "TK_END_EXPR":if(k==="]")if(s){if(g==="}"){K();m();G();break}}else if(c.mode==="[INDENTED-EXPRESSION]")if(g==="]"){G();h();m();break}G();m();break;case "TK_START_BLOCK":y==="do"?w("DO_BLOCK"):w("BLOCK");if(J){if(d!=="TK_OPERATOR")g=="return"?l():h(true);m();c.indentation_level+=1}else{if(d!=="TK_OPERATOR"&&d!=="TK_START_EXPR")d==="TK_START_BLOCK"?
h():l();else if(D(c.previous_mode)&&g===",")r==="}"?l():h();c.indentation_level+=1;m()}break;case "TK_END_BLOCK":G();if(J)h();else if(d==="TK_START_BLOCK")v?K():C();else if(D(c.mode)&&s){s=false;h();s=true}else h();m();break;case "TK_WORD":if(H){l();m();l();H=false;break}if(k==="function")if((v||g===";")&&g!=="{"){t=v?t:0;N||(t=1);for(n=0;n<2-t;n++)h(false)}if(k==="case"||k==="default"){if(g===":")K();else{c.indentation_level--;h();c.indentation_level++}m();c.in_case=true;break}n="NONE";if(d==="TK_END_BLOCK")if(o(k.toLowerCase(),
["else","catch","finally"]))if(J)n="NEWLINE";else{n="SPACE";l()}else n="NEWLINE";else if(d==="TK_SEMICOLON"&&(c.mode==="BLOCK"||c.mode==="DO_BLOCK"))n="NEWLINE";else if(d==="TK_SEMICOLON"&&F(c.mode))n="SPACE";else if(d==="TK_STRING")n="NEWLINE";else if(d==="TK_WORD")n="SPACE";else if(d==="TK_START_BLOCK")n="NEWLINE";else if(d==="TK_END_EXPR"){l();n="NEWLINE"}if(c.if_line&&d==="TK_END_EXPR")c.if_line=false;if(o(k.toLowerCase(),["else","catch","finally"]))if(d!=="TK_END_BLOCK"||J)h();else{C(true);l()}else if(o(k,
z)||n==="NEWLINE"){if(!((d==="TK_START_EXPR"||g==="="||g===",")&&k==="function"))if(g==="return"||g==="throw")l();else if(d!=="TK_END_EXPR"){if((d!=="TK_START_EXPR"||k!=="var")&&g!==":")k==="if"&&y==="else"&&g!=="{"?l():h()}else o(k,z)&&g!==")"&&h()}else if(D(c.mode)&&g===","&&r==="}")h();else n==="SPACE"&&l();m();y=k;if(k==="var"){c.var_line=true;c.var_line_reindented=false;c.var_line_tainted=false}if(k==="if")c.if_line=true;if(k==="else")c.if_line=false;break;case "TK_SEMICOLON":m();c.var_line=
false;c.var_line_reindented=false;break;case "TK_STRING":if(d==="TK_START_BLOCK"||d==="TK_END_BLOCK"||d==="TK_SEMICOLON")h();else d==="TK_WORD"&&l();m();break;case "TK_EQUALS":if(c.var_line)c.var_line_tainted=true;l();m();l();break;case "TK_OPERATOR":n=r=true;if(c.var_line&&k===","&&F(c.mode))c.var_line_tainted=false;if(c.var_line)if(k===",")if(c.var_line_tainted){m();c.var_line_reindented=true;c.var_line_tainted=false;h();break}else c.var_line_tainted=false;if(g==="return"||g==="throw"){l();m();
break}if(k===":"&&c.in_case){m();h();c.in_case=false;break}if(k==="::"){m();break}if(k===","){if(c.var_line)if(c.var_line_tainted){m();h();c.var_line_tainted=false}else{m();l()}else if(d==="TK_END_BLOCK"&&c.mode!=="(EXPRESSION)"){m();c.mode==="OBJECT"&&g==="}"?h():l()}else if(c.mode==="OBJECT"){m();h()}else{m();l()}break}else if(o(k,["--","++","!"])||o(k,["-","+"])&&(o(d,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||o(g,z))){n=r=false;if(g===";"&&F(c.mode))r=true;if(d==="TK_WORD"&&
o(g,z))r=true;if(c.mode==="BLOCK"&&(g==="{"||g===";"))h()}else if(k===".")r=false;else if(k===":")if(!U()){c.mode="OBJECT";r=false}r&&l();m();n&&l();break;case "TK_BLOCK_COMMENT":r=k.split(/\x0a|\x0d\x0a/);if(/^\/\*\*/.test(k)){h();e.push(r[0]);for(n=1;n<r.length;n++){h();e.push(" ");e.push(r[n].replace(/^\s\s*|\s\s*$/,""))}}else{if(r.length>1){h();C()}else l();for(n=0;n<r.length;n++){e.push(r[n]);e.push("\n")}}h();break;case "TK_INLINE_COMMENT":l();m();F(c.mode)?l():h();break;case "TK_COMMENT":B?
h():l();m();h();break;case "TK_UNKNOWN":if(g==="return"||g==="throw")l();m()}r=g;d=A;g=k}return e.join("").replace(/[\n ]+$/,"")}if(typeof exports!=="undefined")exports.js_beautify=js_beautify;
